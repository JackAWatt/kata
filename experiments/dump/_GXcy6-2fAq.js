if (self.CavalryLogger) { CavalryLogger.start_js(["5BLhq"]); }

__d('UFIMentionsInput.react',['cx','Arbiter','BanzaiScuba','Bootloader','DraftEntity','DraftModifier','DOMVector','EditorState','Input','Keys','MentionsInput.react','React','ReactDOM','UFIUIEvents','URI','UFIConfig','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createMentionEntity','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=new (c('BanzaiScuba'))('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),j=200,k='ufi_comment_composer',l='ufi_reply_composer',m=c('canUseReactEditor')(),n=c('React').PropTypes;function o(s){var t=s.map(function(u){return {kind:'file',type:u.type,getAsFile:c('emptyFunction').thatReturns(u)};});return {clipboardData:{items:t}};}function p(s){var t=/^image\//;return s.filter(function(u){return t.test(u.type);});}var q=c('React').createClass({displayName:'UFIMentionsInput',propTypes:{onContentChange:n.func},getInitialState:function s(){var t='',u=[];c('Arbiter').subscribe('Story/delete',function(w){this._clearDocumentState();}.bind(this));if(this.props.initialData){t=this.props.initialData.value||'';u=this.props.initialData.mentions||[];u=u.map(function(w){return babelHelpers['extends']({},w,{entity:{uid:w.uid,weakreference:w.weakreference}});});}var v=c('createEditorStateWithEntities')({text:t,ranges:u,decorator:c('getMentionsInputDecorator')(),entityCreationFn:r});v=c('EditorState').moveSelectionToEnd(v);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:v,mentionsSource:null,mentionableEntries:null,fallbackText:t};},hasEnteredText:function s(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},focus:function s(){this._triggerFullRender(function(){if(m){this.refs.mentionsInput.focus();}else c('ReactDOM').findDOMNode(this.refs.textarea).focus();}.bind(this));},submitComment:function s(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function s(t){this._triggerFullRender(function(){if(m){var u=this.state.editorState,v=u.getSelection(),w=u.getCurrentContent(),x=v.getStartKey(),y=v.getStartOffset(),z=w.getBlockForKey(x),aa;if(z.getText().substr(y-1,1).trim().length>0){var ba=c('DraftModifier').replaceText(w,v,' ');v=ba.getSelectionAfter();aa=c('DraftModifier').insertText(ba,v,t.getTitle(),u.getCurrentInlineStyle(),c('createMentionEntity')(t));}else aa=c('DraftModifier').replaceText(w,v,t.getTitle(),u.getCurrentInlineStyle(),c('createMentionEntity')(t));v=aa.getSelectionAfter();aa=c('DraftModifier').insertText(aa,v,' ');u=c('EditorState').push(u,aa,'insert-fragment');u=c('EditorState').forceSelection(u,u.getSelection());this.setState({editorState:u});this.focus();}else{c('ReactDOM').findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+t.title});}else this.setState({fallbackText:t.title});}}.bind(this));},insertEmoticon:function s(t){if(!m){this.setState({fallbackText:this.state.fallbackText+' '+t});return;}var u=this.state.editorState,v=u.getCurrentContent(),w=u.getSelection(),x=v.getBlockForKey(w.getStartKey()).getText()[w.getStartOffset()-1];if(x&&x!==' ')t=' '+t;var y=v.getBlockForKey(w.getEndKey()).getText()[w.getEndOffset()];if(y&&y!==' ')t+=' ';var z=c('DraftModifier').replaceText(u.getCurrentContent(),u.getSelection(),t);u=c('EditorState').push(u,z,'insert-characters');u=c('EditorState').forceSelection(u,u.getSelection());this.setState({editorState:u});},_informHeightChange:function s(){if(this.props.monitorHeight)c('setImmediate')(function(){if(!this.isMounted())return;var t=m?c('ReactDOM').findDOMNode(this.refs.mentionsInput):c('ReactDOM').findDOMNode(this.refs.textarea),u=c('DOMVector').getElementDimensions(t).y;if(u!==this._height){this._height=u;c('Arbiter').inform(c('UFIUIEvents').InputHeightChanged,{node:t});}}.bind(this));},_onChange:function s(t){if(this.props.onContentChange){var u=this.state.editorState.getCurrentContent(),v=t.getCurrentContent();if(u!==v)this.props.onContentChange(c('getMentionsTextForContentState')(v));}this.setState({editorState:t},this._informHeightChange);},_clearDocumentState:function s(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var t=c('EditorState').createEmpty(c('getMentionsInputDecorator')());this.setState({editorState:c('EditorState').moveFocusToEnd(t)});},_handleContentReturn:function s(t){if(c('isSoftNewlineEvent')(t)){this.setState(function(u){var v=u.editorState;return {editorState:c('handleSoftNewlineForEmoticon')(v)};});return true;}t.persist();this.setState({},function(){if(this._submitComment(t))this._clearDocumentState();}.bind(this));return true;},_handleBeforeInput:function s(t){var u=c('handleBeforeInputForEmoticon')(this.state.editorState,t);if(u===this.state.editorState){return false;}else{this.setState({editorState:u});return true;}},_submitComment:function s(t){var u=this.state.editorState.getCurrentContent(),v=c('getVisibleValueForContentState')(u),w=c('getMentionsTextForContentState')(u),x={visibleValue:v,encodedValue:w},y=c('Input').getValue(c('ReactDOM').findDOMNode(this.refs.proxyInput));if(y){var z=new (c('URI'))(b.location.href);i.addNormal('path',z.getPath());i.addNormal('proxy_value',y.substr(0,j));i.post();}return this.props.onEnterSubmit(x,t);},_handleFiles:function s(t){var u=p(t);if(u.length){this.props.onPaste(o(u));return true;}return false;},_handleDroppedFiles:function s(t,u){return this._handleFiles(u);},_handlePastedFiles:function s(t){return this._handleFiles(t);},_onMentionsInputBlur:function s(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();c('Arbiter').inform(c('UFIUIEvents').Blur,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID,hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function s(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;c('Bootloader').loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(t,u){if(!this.isMounted())return;var v=new t({event_name:'tinder_mentions'});v.sessionStart();var w=u(this.props.datasource,v,c('UFIConfig').showHashtagTypeahead);w.bootstrap();this.setState({typeaheadReporter:v,bootloaded:true,mentionsSource:w},function(){this._currentlyBootloading=false;}.bind(this));}.bind(this),'UFIMentionsInput.react');}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();c('Arbiter').inform(c('UFIUIEvents').Focus,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID});},_onShowMentions:function s(t,u){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(t.map(function(v){return v.getUniqueID();}));},_onAddMention:function s(t,u,v){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(t.getUniqueID(),t.getType(),u,v.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function s(t){if(t.which!==c('Keys').RETURN)return;if(c('isSoftNewlineEvent')(t)||!this.state.fallbackText.trim())return;t.preventDefault();var u={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(u,t))this.setState({fallbackText:''});},_onFallbackChange:function s(t){this.setState({fallbackText:t.target.value});},_onFallbackBlur:function s(t){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function s(t){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function s(t,u){var v=t.getAuxiliaryData().renderType,w=u.getAuxiliaryData().renderType;if(v===w)return t.getOrder()-u.getOrder();var x=this.props.viewOptionsTypeObjectsOrder;return x.indexOf(v)-x.indexOf(w);},_triggerFullRender:function s(t){this.setState({fullRender:true},t);},_triggerFullRenderWithoutCallback:function s(){this._triggerFullRender();},_renderFallback:function s(){return (c('React').createElement('div',null,c('React').createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function s(){if(!this.props.hideProxyInput){var t="_1osa mentionsHidden";return (c('React').createElement('input',{className:t,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function s(){var t="UFIAddCommentInput _1osb _1osc";return (c('React').createElement('div',{onFocus:this._triggerFullRenderWithoutCallback,onSelect:c('emptyFunction'),onClick:this._triggerFullRenderWithoutCallback,onTouchStart:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback},this._renderProxyInput(),c('React').createElement('div',{className:t},this.props.placeholder)));},_onClickEditorContainer:function s(t){c('clickRefAction')('ufi',t.target,null,'FORCE');},_renderMentionsInput:function s(){var t="UFIAddCommentInput _1osb",u=babelHelpers['extends']({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (c('React').createElement('div',{onClick:this._onClickEditorContainer},this._renderProxyInput(),c('React').createElement(c('MentionsInput.react'),{ref:'mentionsInput',className:t,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:u,spellCheck:true,showEmojiPicker:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,webDriverTestID:this.props.replyCommentID?l:k})));},componentDidMount:function s(){if(!m){if(this.state.fallbackText)c('ReactDOM').findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())c('setImmediate')(function(){this.isMounted()&&this.focus();}.bind(this));},render:function s(){if(!m)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function r(s){return c('DraftEntity').create('MENTION','IMMUTABLE',{id:s.uid,isWeak:s.weakreference});}f.exports=q;}),null);