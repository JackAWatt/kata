if (self.CavalryLogger) { CavalryLogger.start_js(["WRUgD"]); }

__d('PhotoPermalinkTagger',['Arbiter','Event','PhotoPermalink','PhotoTagger','$'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('PhotoTagger'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,c('PhotoPermalink').getInstance(),true);this.photoData=k;}j.prototype.setupHandlers=function(){'use strict';var k=c('$')('imagestage'),l=c('$')('fbPhotoPageTagBoxes');this.handlers=[c('Event').listen(this.clickState,'click',this.addTag.bind(this)),c('Event').listen(k,'click',this.addTag.bind(this)),c('Event').listen(l,'click',this.addTag.bind(this)),c('Event').listen(this.addTagLink,'click',this.checkActions.bind(this)),c('Event').listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[c('Arbiter').subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),c('Arbiter').subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),c('Arbiter').subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};j.prototype.setDataForTokenizer=function(){'use strict';this.tokenizer.setup(null,this.photoData);return this;};Object.assign(j.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});f.exports=j;}),null);
__d('legacy:PhotoPermalinkTagger',['PhotoPermalinkTagger'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalinkTagger=c('PhotoPermalinkTagger');}),3);
__d('legacy:fb-photos-permalink-js',['PhotoPermalink'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalink=c('PhotoPermalink');}),3);
__d('TagToken',['DOM','Token'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('Token'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k,'tag');}j.prototype.createElement=function(){'use strict';var k=this.isFreeform(),l=c('DOM').create('span',{className:'separator'},', '),m=c('DOM').create(k?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!k)m.href=this.getInfo().path;return c('DOM').create('span',{className:'tagItem'},[l,m]);};f.exports=j;}),null);
__d('TagTokenizer',['fbt','Arbiter','CSS','DOM','Parent','TagToken','Tokenizer','createObjectFrom','ge','getElementText'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('Tokenizer'));j=i&&i.prototype;function k(l,m,n,o,p){'use strict';j.constructor.call(this,n,o,p);c('Arbiter').subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),c('Arbiter').SUBSCRIBE_NEW);this.appphoto=m;c('Arbiter').subscribe(l.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),c('Arbiter').SUBSCRIBE_NEW);}k.prototype.setup=function(l,m){'use strict';this.appphoto=m.byapp;this.byowner=m.isowner;return this.reset();};k.prototype.reset=function(){'use strict';var l=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var m=this.getWithTagTokenElements().map(function(n){return this._tokenKey(this.getTokenDataFromTag(n));}.bind(this));this.withTagKeys=c('createObjectFrom')(m);return j.reset.call(this,l);};k.prototype.processEvents=function(event,l,m){'use strict';if(c('Parent').byClass(l,'remove')){var n=this.getTokenFromElement(m);n=this.addTokenData(n,l);this.removeToken(n);event.kill();}};k.prototype.insertToken=function(l){'use strict';return null;};k.prototype.removeToken=function(l){'use strict';if(this.appphoto){return this.replaceToken(l);}else{this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});}};k.prototype.addTokenData=function(l,m){'use strict';if(c('Parent').byClass(m,'blockuser'))l.blockUser=true;return l;};k.prototype.getTokenDataFromTag=function(l){'use strict';return {uid:c('DOM').find(l,'input').value,text:c('getElementText')(c('DOM').find(l,'.taggee'))};};k.prototype.getTokenElementFromTarget=function(l){'use strict';return c('Parent').byClass(l,'tagItem');};k.prototype.getTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));};k.prototype.getWithTagTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.withTagItem');};k.prototype.filterNonTokenElements=function(l){'use strict';return !c('CSS').hasClass(l,'markasspam')&&!c('CSS').hasClass(l,'reported')&&!c('CSS').hasClass(l,'withTagItem');};k.prototype.createToken=function(l,m){'use strict';var n=this.getToken(this._tokenKey(l));n=n||new (c('TagToken'))(l);m&&n.setElement(m);return n;};k.prototype.updateTokenareaVisibility=function(){'use strict';var l=this.getTokenElements().filter(function(o){return c('CSS').shown(o);}),m=this.getWithTagTokenElements(),n=c('DOM').scry(this.tokenarea,'span.ogTagItem');c('CSS').conditionShow(this.tokenarea,l.length!==0||m.length!==0||n.length!==0);};k.prototype.replaceToken=function(l){'use strict';if(!l)return;var m=this.tokens.indexOf(l);if(m<0)return;this.tokens.splice(this.tokens.indexOf(l),1);delete this.unique[this._tokenKey(l.getInfo())];var n=c('ge')('tagspam'+l.getValue());n&&c('DOM').remove(n);var o=[' [',h._("Tag removed."),' '];o.push(c('DOM').create('a',{onclick:this.markAsSpam.bind(this,l.getValue())},h._("Mark tag as spam")));o.push('] ');var p=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+l.getValue()},o);c('DOM').replace(l.getElement(),p);this.updateTokenarea();this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});};k.prototype.markAsSpam=function(l){'use strict';var m=c('ge')('tagspam'+l),n=[' [',h._("Tag reported"),'] '],o=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+l},n);c('DOM').replace(m,o);this.inform('markTagAsSpam',l);};f.exports=k;}),null);
__d('TagTypeaheadView',['AsyncRequest','ContextualTypeaheadView','CSS','DOM','Parent','FamilyTaggingConfig'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ContextualTypeaheadView'));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this,k,l);this.hintText=l.hintText;this.userEd=l.userEd;this.origAutoSelect=l.autoSelect;this.setSuggestions(l.suggestions);}j.prototype.init=function(){'use strict';c('CSS').addClass(this.element,'uiTagTypeaheadView');i.init.call(this);};j.prototype.buildResults=function(k){'use strict';if(!this.value&&this.hintText)k.unshift({subtext:this.hintText,type:'hintText'});if(this.userEd){new (c('AsyncRequest'))().setURI('/ajax/fof/user_education.php').setData({increment:1}).send();k.unshift({subtext:this.userEd,type:'userEdText'});}if(c('FamilyTaggingConfig').gk){var l=[],m=[];for(var n=0;n<k.length;n++)if(k[n].type!=='family_tags'&&k[n].index!=-1000&&k[n].type!=='hintText'){l.push(k[n]);}else m.push(k[n]);k=m.concat(l);i.updateResults.call(this,k);}var o=i.buildResults.call(this,k);if(this.userEd)k.shift();if(!this.value)k.shift();return o;};j.prototype.show=function(){'use strict';var k=c('DOM').scry(this.context,'.typeaheadBackdrop');if(k.length>0)c('CSS').addClass(k[0],'resultsPresent');return i.show.call(this);};j.prototype.hide=function(){'use strict';var k=c('DOM').scry(this.context,'.typeaheadBackdrop');if(k.length>0)c('CSS').removeClass(k[0],'resultsPresent');return i.hide.call(this);};j.prototype.render=function(k,l,m){'use strict';this.autoSelect=this.origAutoSelect&&k.length;this.disableAutoSelect=k.length===0;i.render.call(this,k,l,m);};j.prototype.getItems=function(){'use strict';var k=i.getItems.call(this);if(!this.value)k.shift();if(this.userEd)k.shift();return k;};j.prototype.getSuggestions=function(){'use strict';return this.suggestions;};j.prototype.setSuggestions=function(k){'use strict';this.suggestions=k?k.map(String):[];this.visible=!!this.suggestions.length;};j.prototype.addSuggestion=function(k){'use strict';this.suggestions.unshift(k);};j.prototype.addTypeaheadFlip=function(k){'use strict';c('CSS').addClass(this.element,k);};j.prototype.removeTypeaheadFlip=function(k){'use strict';c('CSS').removeClass(this.element,k);};j.prototype.getContext=function(){'use strict';var k=c('Parent').byClass(this.element,'typeaheadContainer');if(k){return k;}else return i.getContext.call(this);};f.exports=j;}),null);
__d('FreeformTokenizerBehavior',['Event','Input','Keys'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j.matcher&&new RegExp(j.matcher,'i'),l=j.splitter&&new RegExp(j.splitter),m=j.tokenize_on_blur!==false,n=j.tokenize_on_paste!==false,o=j.split_on_check===true,p=j.select_on_comma!==false,q=j.select_on_space===true,r=j.never_submit===true;function s(event){var t=c('Input').getValue(i.getInput()).trim();if(l&&event&&event.type=='paste'){t=t.split(l);}else if(l&&o){t=t.split(l);}else t=[t];var u=false;for(var v=0;v<t.length;v++){var w=t[v].trim();if(w&&(!k||k.test(w))){var x={uid:w,text:w,freeform:true};i.addToken(i.createToken(x));u=true;}}if(event&&u){i.getTypeahead().getCore().afterSelect();event.kill();}}i.subscribe('keydown',function(t,u){var event=u.event,v=c('Event').getKeyCode(event);if(v==c('Keys').RETURN||p&&v==c('Keys').COMMA||q&&v==c('Keys').SPACE){var w=i.getTypeahead().getView();if(w.getSelection()){w.select();event.kill();}else s(event);}if(v==c('Keys').RETURN&&r)event.kill();});i.subscribe('paste',function(t,u){if(n)setTimeout(s.bind(null,u.event),20);});i.subscribe('blur',function(t,u){if(m)s();i.getTypeahead().getCore().reset();});}f.exports=h;}),null);
__d('TypeaheadHintText',['emptyFunction'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';this._typeahead.getCore().resetOnKeyup=false;};Object.assign(h.prototype,{disable:c('emptyFunction')});f.exports=h;}),null);
__d('legacy:HintTextTypeaheadBehavior',['TypeaheadHintText'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.hintText=function(h){h.enableBehavior(c('TypeaheadHintText'));};}),3);